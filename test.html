<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Upload Image from Clipboard</title>
  </head>
  <style>
    label {
      display: block;
      cursor: pointer;
      width: 400px;
      height: 400px;
      background-size: cover;
      background-position: center;
      border: 2px dashed #ccc;
    }
  </style>
  <body>
    <h1>Paste an Image or Upload from System</h1>

    <label for="image" id="uploadLabel">
      <!-- The file input will be hidden, and the label will serve as the clickable area -->
      <input type="file" name="image" id="image" style="display: none" />
    </label>

    <button type="button" id="uploadButton">Upload</button>

    <script>
      const fileInput = document.getElementById("image");
      const uploadButton = document.getElementById("uploadButton");
      const label = document.querySelector("#uploadLabel");
      let imageData = null; // Store the image file here

      // Listen for the paste event to handle image pasting
      window.addEventListener("paste", function (event) {
        const items = event.clipboardData.items;
        for (let i = 0; i < items.length; i++) {
          const item = items[i];

          // If the clipboard contains an image as a file
          if (item.type.startsWith("image/")) {
            const file = item.getAsFile();
            imageData = file; // Store the file to upload later

            // Set the background image of the label
            const reader = new FileReader();
            reader.onload = function (e) {
              label.style.backgroundImage = `url(${e.target.result})`;
            };
            reader.readAsDataURL(file); // Read the pasted image as a data URL
          }
        }
      });

      // Listen for changes in the file input to handle uploads from the system
      fileInput.addEventListener("change", function () {
        const file = fileInput.files[0];
        if (file) {
          imageData = file; // Store the file to upload later

          // Set the background image of the label
          const reader = new FileReader();
          reader.onload = function (e) {
            label.style.backgroundImage = `url(${e.target.result})`;
          };
          reader.readAsDataURL(file); // Read the selected image as a data URL
        }
      });

      // Listen for the button click to upload the image
      uploadButton.addEventListener("click", function () {
        if (!imageData && !fileInput.files[0]) {
          alert("No image to upload.");
          return;
        }

        // If an image was pasted, use the pasted image file
        const fileToUpload = imageData || fileInput.files[0];

        // Prepare the FormData
        const formData = new FormData();
        formData.append("image", fileToUpload); // Append the file

        // Upload the image via fetch
        fetch("http://localhost:3000/upload", {
          method: "POST",
          body: formData,
        })
          .then((response) => response.text())
          .then((data) => {
            console.log("File uploaded:", data);
          })
          .catch((error) => {
            console.error("Error uploading file:", error);
          });
      });
    </script>
  </body>
</html>
